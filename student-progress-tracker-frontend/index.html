<!-- register.html -->
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Regisztráció teszt</title>
</head>
<body>
    <h1>Regisztráció</h1>
    <form id="regForm">
        <input type="text" name="uid" placeholder="Neptun kód" required><br>
        <input type="email" name="email" placeholder="E-mail" required><br>
		<input type="password" name="password" placeholder="Jelszó" required><br>
        <input type="text" name="name" placeholder="Név" required><br>
        <input type="date" name="birth_date" placeholder="Születési dátum" required><br>
        <input type="text" name="id_card_number" placeholder="Személyi igazolvány szám" required><br>
        <input type="text" name="address_card_number" placeholder="Lakcímkártya szám" required><br>
        <input type="text" name="mothers_name" placeholder="Anyja neve" required><br>
        <select name="major" required>
		  <option value="Gazdaságinformatikus">Gazdaságinformatikus</option>
		  <option value="Mérnökinformatikus">Mérnökinformatikus</option>
		  <option value="Programtervező informatikus">Programtervező informatikus</option>
		  <option value="Villamosmérnök">Villamosmérnök</option>
		  <option value="Üzemmérnök-informatikus">Üzemmérnök-informatikus</option>
		</select><br>
        <button type="submit">Regisztráció</button>
    </form>
    <div id="msg"></div>
    <script>
    document.getElementById('regForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
            uid: form.uid.value,
            email: form.email.value,
            password: form.password.value,
            name: form.name.value,
            birth_date: form.birth_date.value,
            id_card_number: form.id_card_number.value,
            address_card_number: form.address_card_number.value,
            mothers_name: form.mothers_name.value,
            major: form.major.value
        };
        try {
            const resp = await fetch('http://enaploproject.ddns.net:8000/api/users/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const result = await resp.json();
            if (resp.ok) {
                document.getElementById('msg').innerText = "Sikeres regisztráció! Nézd meg az e-mail fiókodat a megerősítő levélért.";
            } else {
                document.getElementById('msg').innerText = "Hiba: " + (result.detail || "Ismeretlen hiba");
				console.log(result);
            }
        } catch (err) {
            document.getElementById('msg').innerText = "Hálózati hiba: " + err;
        }
    });
    </script>
	
	<h1>Bejelentkezés</h1>
<form id="loginForm">
    <input type="text" name="uid" placeholder="Neptun kód vagy e-mail" required><br>
    <input type="password" name="password" placeholder="Jelszó" required><br>
    <button type="submit">Bejelentkezés</button>
</form>
<div id="loginMsg"></div>

<script>
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    // Régi token törlése, hogy mindig friss legyen
    localStorage.removeItem('access_token');
    const form = e.target;
    
    // e-mail címet vagy Neptun kódot is elfogad:
    const data = form.uid.value.includes('@')
        ? { email: form.uid.value, password: form.password.value }
        : { uid: form.uid.value, password: form.password.value };

    try {
        const resp = await fetch('http://enaploproject.ddns.net:8000/api/users/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        const result = await resp.json();
        if (resp.ok) {
            // a backend JWT-t ad vissza, pl. {access_token: "..."}
            if (result.access_token) {
                localStorage.setItem('access_token', result.access_token);
                document.getElementById('loginMsg').innerText = "Sikeres bejelentkezés! Token elmentve.";
            } else {
                document.getElementById('loginMsg').innerText = "Sikeres bejelentkezés!";
            }
        } else {
            document.getElementById('loginMsg').innerText = (result.detail || result);
        }
    } catch (err) {
        document.getElementById('loginMsg').innerText = "Hálózati hiba: " + err;
    }
});
</script>

<button onclick="logout()">Kijelentkezés</button>
<div id="logoutMsg"></div>
<script>
function logout() {
    if (!localStorage.getItem('access_token')) {
        document.getElementById('logoutMsg').innerText = "Nincs bejelentkezve!";
        return;
    }
    else {
        localStorage.clear();
        document.getElementById('logoutMsg').innerText = "Sikeres kijelentkezés!";
    }
}
</script>

<button onclick="getUsers()">Összes felhasználó lekérése (admin)</button>
<div id="usersMsg"></div>
<script>
async function getUsers() {
    const token = localStorage.getItem('access_token');
    if (!token) {
        document.getElementById('usersMsg').innerText = "Nincs token, jelentkezz be!";
        return;
    }
    const resp = await fetch('http://enaploproject.ddns.net:8000/api/users/', {
        method: 'GET',
        headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
        }
    });
    const result = await resp.json();
    if (resp.ok) {
        document.getElementById('usersMsg').innerText = "Felhasználók száma: " + result.length;
    } else {
        document.getElementById('usersMsg').innerText = "Hiba: " + (result.detail || JSON.stringify(result));
    }
}
</script>
</body>
</html>